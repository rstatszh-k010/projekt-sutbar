---
title: "Nationalratswahlen 2023"
author: "Barbara Sutter"
format:
  html: 
    embeded-resources: true
    toc: true
execute: 
  warning: false
editor_options: 
  chunk_output_type: console
editor: visual
---

```{r}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(forcats)
library(ggthemes)
library(knitr)

read_csv2(here::here("daten/raw/sd-t-17.02-NRW2023-zeitreihen-parteien-APPENDIX (1).csv"))

read_delim(here::here("daten/raw/sd-t-17.02-NRW2023-zeitreihen-parteien-APPENDIX (1).csv"), delim = ";")

```

# Einleitung

Im Rahmen einer kantonalen Weiterbildung des Kantons Zürich - Data Science mit R - wird vertieften Einblick in die Anwendung von R vermittelt. Als Abschlussprojekt des Kurses wird ein OGD-Datensatz verwendet um das vermittelte und gelernte Wissen direkt an einem eigenen Projekt anzuwenden und zu vertiefen.

Die in dem vorliegenden Projekt verwendeten Daten stammen von opendata.swiss und werden vom Bundesamt für Statistik zur Verfügung gestellt. Die Daten thematisieren die Nationalratswahlen der Schweiz und wurden am 30. November 2023 letztmals aktualisiert. Die Daten zeigen eine Zeitreihe zu den Listen, den Kandidierenden, der Parteistärke, der Anzahl Mandate, der Anzahl gewählten Frauen und Männern sowie die jeweils stärkste Partei der jeweiligen Nationalratswahlen. Die Daten sind auf Ebene Schweiz sowie auf Ebene der einzelnen Kantone vorhanden und beginnen im Jahr 1991 bis ins Jahr 2023.

Link: [Nationalratswahlen: Zeitreihen zu Listen, Kandidierenden, Parteistärken, Mandaten, gewählten Frauen und Männern, stärkste Partei (Schweiz und Kantone) \| opendata.swiss](https://opendata.swiss/de/dataset/nationalratswahlen-zeitreihen-zu-listen-kandidierenden-parteistarken-mandaten-gewahlten-frauen-)

Ziel der vorliegenden Abschlussarbeit soll sein, mittels den Daten aufzuzeigen, wie sich die Parteienstärken bei den Nationalratswahlen in den letzten gut 30 Jahren verändert haben. Weiter soll ein Fokus auf die Verteilung der Mandate, welche von Frauen besetzt werden, gelegt werden. Dazu stellen sich folgende Fragen: Ist hier eine Verschiebung zu einem höheren Frauenanteil sichtbar? Kann ein Zusammenhang zwischen Parteienstärke, Frauenanteil und Parteizugehörigkeit gezeigt werden?

# Daten

```{r}
NRW2023_zeitreihe <- read_delim(here::here("daten/raw/sd-t-17.02-NRW2023-zeitreihen-parteien-APPENDIX (1).csv"), delim = ";")

# view(NRW2023_zeitreihe)
```

## Analyseziele

...

## Datenaufbereitung

```{r}
# Daten erkunden

glimpse(NRW2023_zeitreihe)

names(NRW2023_zeitreihe)

nrow(NRW2023_zeitreihe)

ncol(NRW2023_zeitreihe)

# Die Variablen, welche für die Auswertungen nicht gebraucht werden, werden gefiltert und einen neuen Datensatz "NRW2023_zeitreihe_d" erstellt

NRW2023_zeitreihe_d <- NRW2023_zeitreihe |> 
  select(wahl_jahr, ebene_resultat, kanton_nummer, kanton_bezeichnung, partei_id, partei_bezeichnung_de, partei_staerke, flag_staerkste_partei, anzahl_listen, anzahl_kandidierende, anzahl_kandidierende_f, anzahl_kandidierende_m, anzahl_gewaehlte, anzahl_gewaehlte_f, anzahl_gewaehlte_m, frauen_anteil)

# view(NRW2023_zeitreihe_d)

# Es werden die Wahljahre betrachtet, welche im Datensatz vorhanden sind

NRW2023_zeitreihe_d |> 
  distinct(wahl_jahr)

# Es wird ein Datensatz erstellt, welcher zum einen nur die Resultate auf der Ebene Schweiz (NRW2023_zeitreihe_CH)  und zum anderen die Resultate nur auf kantonaler Ebene (NRW2023_zeitreihe_Kanton) enthält

NRW2023_zeitreihe_CH <- NRW2023_zeitreihe_d |> 
  filter(ebene_resultat == "Schweiz")

# view(NRW2023_zeitreihe_CH)

NRW2023_zeitreihe_Kanton <- NRW2023_zeitreihe_d |> 
  filter(ebene_resultat != "Schweiz")

# dasselbe wird danach auch für das Wahljahr 2023 auf nationaler Ebene erstellt

NRW2023_CH_2023 <- NRW2023_zeitreihe_CH |> 
  filter(wahl_jahr == "2023")

# Die CVP und die Mitte-Partei wird über den gesamten Datensatz in CVP/Mitte umbenannt, sodass die Daten vergleichbar bleiben.

NRW2023_zeitreihe_Kanton |> 
  mutate(partei_bezeichnung_de = case_when(
    partei_bezeichnung_de == "CVP" ~ "CVP/Mitte",
    partei_bezeichnung_de == "Mitte" ~ "CVP/Mitte",
    .default = partei_bezeichnung_de
  ))


```

## Daten Visualisierung

### 1. Parteienstärke bei den Nationalratswahlen 2023

```{r}
# Die Daten aus dem Wahljahr 2023 werden betrachtet und visualisiert:

NRW2023_CH_2023

# Visualisierung 1:

# Bei der folgenden Tabelle werden die Parteienstärke bei den Wahlen 2023 abgebildet. Die stärkste Partei ist klar die SVP, gefolgt von der SP, danach positioniert sich die FDP knapp vor der Mitte.


NRW2023_CH_2023 |> 
  select(partei_bezeichnung_de, partei_staerke)

# Die NA's bei der CVP und BDP werden auf 0 gesetzt, da der NA-Wert tatsächlich als 0 angesehen werden kann (Das Fehlen der Werte bedeutet inhaltlich 0, da es bei diesen zwei Parteien keine Nennungen gibt. Im Wahljahr 2023 exisitierten sie nicht mehr unter dem alten Namen.)

NRW2023_CH_2023_total <- NRW2023_CH_2023 |> 
  mutate(partei_staerke = replace_na(partei_staerke, 0),
         flag_staerkste_partei = replace_na(flag_staerkste_partei, 0),
         anzahl_listen = replace_na(anzahl_listen, 0),
         anzahl_kandidierende = replace_na(anzahl_kandidierende, 0),
         anzahl_kandidierende_f = replace_na(anzahl_kandidierende_f, 0),
         anzahl_kandidierende_m = replace_na(anzahl_kandidierende_m, 0),
         anzahl_gewaehlte = replace_na(anzahl_gewaehlte, 0),
         anzahl_gewaehlte_f = replace_na(anzahl_gewaehlte_f, 0),
         anzahl_gewaehlte_m = replace_na(anzahl_gewaehlte_m, 0),
         frauen_anteil = replace_na(frauen_anteil, 0))

# Danach wird eine Grafik erstellt, bei welcher man die Verteilung der Parteien nach Grösse auf einen Blick sieht

ggplot(data = NRW2023_CH_2023_total,
       mapping = aes (y = partei_staerke,
                      x = reorder(partei_bezeichnung_de, partei_staerke))) +
      geom_col() +
      geom_text(aes(label = paste0(round(partei_staerke, 1), "%")),
                vjust = -0.5, size = 3) +
      theme_minimal() +
      theme_minimal(base_size = 12) +
      theme(panel.grid.major.x = element_blank(),
            axis.text.x = element_text(angle = 90, vjust = 0.5)) +
      # scale_fill_manual(values = c("blue")) +
      labs(title = "Parteienstärke bei den Nationalratswahlen 2023",
            y = "Parteienstärke in Prozent",
            x = "Partei")
```

```{r}
    
```

```{r}

```

### 2. Anzahl gewählte Frauen

```{r}
# Visualisierung 2: Summe Anzahl gewählter Frauen über alle Kantone und Parteien.

    # Im Jahr 2023 sind viele NAs enthalten. Nachschauen warum das so ist: Es sind viele Parteien (z.B. CVP), welche im 2023 keine Liste resp. keine Kandididerende mehr hatten. Muss ich diese bearbeiten oder kann ich diese einfach ignorieren?

NRW2023_zeitreihe_Kanton |> 
  select(wahl_jahr, frauen_anteil, anzahl_gewaehlte_f) |> 
  filter(!is.na(anzahl_gewaehlte_f)) |> 
  group_by(wahl_jahr) |> 
  summarise(sum_anzahl_gewaehlte_f = sum(anzahl_gewaehlte_f)) |> 
  ggplot(aes(x = wahl_jahr,
             y = sum_anzahl_gewaehlte_f)) +
  geom_point() +
  geom_line() +
  theme_minimal() +
      theme_minimal(base_size = 12) +
      theme(panel.grid.major.x = element_blank(),
            axis.text.x = element_text(angle = 90, vjust = 0.5)) +
      labs(title = "Total gewählte Frauen über alle Kantone und Parteien",
            y = "Summe aller gewählten Frauen",
            x = "Jahr der Nationalratswahlen")
  


# Tabelle xy: Anzahl gewählte Frauen (mit gt und einer function(x)):

NRW2023_zeitreihe_Kanton |> 
  select(wahl_jahr, frauen_anteil, anzahl_gewaehlte_f) |> 
  filter(!is.na(anzahl_gewaehlte_f)) |> 
  group_by(wahl_jahr) |> 
  summarise(sum_anzahl_gewaehlte_f = sum(anzahl_gewaehlte_f)) 
  
gewaehlte_f_prozent <- function(x) {
  round(x / sum(x, na.rm = TRUE) * 100, 1)
}
  
# Nun habe ich die Prozentwerte mittels einer function(x) definiert. Gerne würde ich  eine schöne Tabelle machen mit den Werten: wahl_jahr, sum_anzahl_gewaehlte_f, gewaehlte_f_prozent. Aber beim Befehl mutate() gibt es mir eine Fehlermeldung aus. Warum?

NRW2023_zeitreihe_Kanton |> 
  filter(!is.na(anzahl_gewaehlte_f)) |> 
  group_by(wahl_jahr) |> 
  summarise(sum_anzahl_gewaehlte_f = sum(anzahl_gewaehlte_f)) |>
  mutate(prozent = gewaehlte_f_prozent(sum_anzahl_gewaehlte_f)) |> 
  gt::gt()
  

```

3.  Entwicklung Frauen-Anteil in den Parteien und Kantone

```{r}

```

```{r}

# Visualisierung 3.1: Entwicklung Frauen-Anteil pro Partei in einem Kanton, pro Partei

## gerne würde ich hier die Bundesratsparteien plus die beiden Parteien mit Anspruch darauf filtern (SVP, SP, FDP, Mitte, Grüne und GLP), da alle Parteien zusammen zu unübersichtlich werden: filter(partei_bezeichnung_de in %in% c("SVP, "SP"...)) funktioniert aber nicht... Any ideas? :)

partei_bundespartei <- c("FDP", "SVP", "SP", "GRÜNE", "CVP/Mitte", "GLP")

NRW2023_zeitreihe_Kanton |> 
 mutate(partei_bezeichnung_de = case_when(
  partei_bezeichnung_de == "CVP" ~ "CVP/Mitte",
  partei_bezeichnung_de == "Mitte" ~ "CVP/Mitte",
  .default = partei_bezeichnung_de
  )) |> 
  filter(kanton_bezeichnung == "Zürich") |> 
  filter(partei_bezeichnung_de %in% partei_bundespartei) |> 
  # filter(partei_bezeichnung_de == "SVP") |> 
  ggplot(mapping = aes(x = wahl_jahr, 
                       y = frauen_anteil,
                       color = partei_bezeichnung_de)) +
  geom_point(size = 3) +
  geom_line(size = 1)  +
  scale_color_colorblind() +
  theme_minimal()

# Visualisierung 3.2: Entwicklung Frauen-Anteil pro Partei in einem Kanton, pro Partei
## Vielen Dank für den Vorschlag. Den übernehme ich sehr gerne!

NRW2023_zeitreihe_Kanton |> 
  filter(kanton_bezeichnung == "Zürich") |> 
  # filter(partei_bezeichnung_de == "SVP") |> 
  ggplot(mapping = aes(x = wahl_jahr, 
                       y = frauen_anteil)) +
  geom_point() +
  geom_line() +
  facet_wrap(~partei_bezeichnung_de)


```

### 4. Direktvergleich der Parteienstärke im Kanton Zürich

```{r}
  
# Visualisierung 4:


# Direktvergleich der Parteienstärke der letzten neun Nationalratswahlen der fünf grössten Parteien im Kanton Zürich

partei_fuenf_groesste <- c("FDP", "SVP", "SP", "GRÜNE", "CVP/Mitte")

NRW2023_zeitreihe_Kanton |> 
 mutate(partei_bezeichnung_de = case_when(
  partei_bezeichnung_de == "CVP" ~ "CVP/Mitte",
  partei_bezeichnung_de == "Mitte" ~ "CVP/Mitte",
  .default = partei_bezeichnung_de
  )) |>
  filter(kanton_bezeichnung == "Zürich") |> 
  # CVP und BDP haben NA für 2023. CVP weil sie umbenannt wurde. BDP ist hier nicht 
  # relevant. Deshalb herausgefiltert.
  filter(!is.na(partei_staerke)) |> 
  filter(partei_bezeichnung_de %in% partei_fuenf_groesste) |> 
  
  # plot
  
  ggplot(mapping = aes(x = wahl_jahr, 
                       y = partei_staerke,
                       color = partei_bezeichnung_de)) +
  geom_point() +
  geom_line()


# Wie hat sich die Parteienstärke bei den letzten neun Nationalratswahlen am Beispiel der FDP im Kanton Zürich entwickelt?

NRW2023_zeitreihe_FDP_Zürich <- NRW2023_zeitreihe_Kanton |> 
  filter(partei_bezeichnung_de == "FDP", kanton_bezeichnung == "Zürich")


ggplot(data = NRW2023_zeitreihe_FDP_Zürich,
       mapping = aes(x = wahl_jahr, 
                     y = partei_staerke)) +
      geom_line()
```
